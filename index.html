<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DASHBOARD - Districk KUPANG</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { 
      margin:0; 
      font-family:Arial, sans-serif; 
      background:#f4f6f9;
      padding-top: 80px; /* Memberi ruang untuk header fixed */
    }
    header {
      background:#c60000; 
      color:#fff; 
      padding:15px 20px;
      text-align:center; 
      font-size:20px; 
      font-weight:bold;
      display:flex; 
      align-items:center; 
      justify-content:space-between; /* Mengubah justify-content */
      position: fixed; /* Membuat header tetap di atas */
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000; /* Memastikan header di atas elemen lain */
      box-shadow: 0 2px 10px rgba(0,0,0,0.2); /* Menambahkan bayangan untuk efek floating */
    }
    .header-left {
      display: flex;
      align-items: center;
    }
    header img { 
      height:50px; 
      border-radius:6px; 
      margin-right: 15px; /* Menambah jarak antara logo dan judul */
    }
    .header-title {
      flex-grow: 1; /* Memungkinkan judul tetap di tengah */
    }
    .header-right {
      width: 65px; /* Menyeimbangkan dengan ukuran logo */
    }
    .sidebar {
      position:fixed; 
      top:80px; /* Menyesuaikan posisi sidebar di bawah header fixed */
      left:0; 
      width:220px; 
      height:calc(100% - 80px); /* Menyesuaikan tinggi sidebar */
      background:#000000; 
      padding-top:20px; /* Mengurangi padding atas */
      overflow-y: auto; /* Menambahkan scroll jika konten sidebar terlalu panjang */
    }
    .sidebar a {
      display:block; 
      color:#fff; 
      padding:12px 20px;
      text-decoration:none; 
      font-size:16px;
      transition: all 0.3s ease; /* Menambahkan transisi untuk efek hover */
    }
    .sidebar a:hover { 
      background:#1abc9c; 
      padding-left: 25px; /* Efek geser saat hover */
    }
    .sidebar a i {
      margin-right: 10px; /* Memberi jarak antara icon dan teks */
      width: 20px; /* Menjaga alignment icon */
      text-align: center;
    }
    .content { 
      margin-left:220px; 
      padding:20px; 
    }
    .card {
      background:#fff; 
      padding:20px; 
      margin-bottom:20px;
      border-radius:8px; 
      box-shadow:0 2px 5px rgba(0,0,0,0.1);
      transition: transform 0.3s ease; /* Efek hover pada card */
    }
    .card:hover {
      transform: translateY(-5px); /* Efek mengangkat card saat hover */
      box-shadow: 0 5px 15px rgba(0,0,0,0.2); /* Bayangan lebih besar saat hover */
    }
    h2 {
      color: #c60000; /* Warna judul sesuai tema */
      border-bottom: 2px solid #c60000; /* Garis bawah judul */
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    h3 {
      color: #333;
      margin-top: 20px;
      margin-bottom: 10px;
    }
    .settings-section {
      margin-bottom: 25px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #c60000;
    }
    .settings-section h3 {
      margin-top: 0;
      color: #c60000;
    }
    .table-wrapper {
      margin-top: 15px;
    }
    .tools-container {
      position: sticky;
      top: 0;
      background: #fff;
      z-index: 20;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    .table-container {
      max-height: 500px; /* Membatasi tinggi tabel */
      overflow-y: auto; /* Menambahkan scroll vertikal */
    }
    table { 
      width:100%; 
      border-collapse:collapse; 
      font-size:14px; 
      white-space: nowrap; /* Mencegah teks wrap ke baris baru */
    }
    table th, table td {
      border:1px solid #ccc; 
      padding:8px; /* Menambah padding untuk kenyamanan membaca */
      text-align: left; /* Default alignment ke kiri */
    }
    table th { 
      background:#c60000; /* Warna header tabel sesuai gambar */
      color:#fff; 
      font-weight: bold;
      position: sticky; /* Membuat header tabel tetap */
      top: 0; /* Menempel di atas saat scroll */
      z-index: 10; /* Memastikan header di atas baris data */
      text-align: center; /* Header tetap rata tengah */
    }
    table tr:nth-child(even) { 
      background:#f9f9f9; 
    }
    table tr:hover {
      background: #e8f4fc; /* Efek hover pada baris tabel */
    }
    /* Perubahan untuk alignment tabel */
    .text-center {
      text-align: center;
    }
    .text-left {
      text-align: left;
    }
    .tools { 
      display:flex; 
      gap:20px; 
      align-items:center; 
      flex-wrap:wrap;
      background: #f8f9fa;
      padding: 10px;
      border-radius: 5px;
    }
    .tools label { 
      font-weight:bold; 
      margin-right:8px; 
      color: #333;
    }
    .tools input, .tools select { 
      padding:8px; 
      font-size:14px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .tools input:focus, .tools select:focus {
      outline: none;
      border-color: #c60000;
      box-shadow: 0 0 5px rgba(198, 0, 0, 0.3);
    }
    .pagination { 
      margin-top:15px; 
      text-align:center; 
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .pagination button {
      padding:8px 15px; 
      margin:0 5px;
      border:none; 
      border-radius:4px;
      background:#2c3e50; 
      color:#fff; 
      cursor:pointer;
      transition: all 0.3s ease;
    }
    .pagination button:hover {
      background: #1abc9c;
    }
    .pagination button:disabled { 
      background:#aaa; 
      cursor:not-allowed; 
    }
    .pagination-controls {
      display: flex;
      align-items: center;
    }
    .pagination-info {
      flex-grow: 1;
      text-align: center;
    }
    .rows-per-page {
      display: flex;
      align-items: center;
    }
    input[type="file"] {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #f8f9fa;
      cursor: pointer;
    }
    input[type="file"]:hover {
      background: #e9ecef;
    }
    .dropdown-arrow {
      position: relative;
      display: inline-block;
    }
    .dropdown-arrow::after {
      content: '\f078';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
    }
    .status-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
    }
    .status-pending {
      background-color: #f39c12;
      color: white;
    }
    .status-approved {
      background-color: #27ae60;
      color: white;
    }
    .status-rejected {
      background-color: #e74c3c;
      color: white;
    }
    .status-returned {
      background-color: #3498db;
      color: white;
    }
    .filter-value {
      margin-left: 10px;
      padding: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 80px;
    }
    .notification {
      position: fixed;
      top: 90px;
      right: 20px;
      background: #27ae60;
      color: white;
      padding: 15px 20px;
      border-radius: 5px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      z-index: 1001;
      display: none;
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    .btn {
      padding: 8px 15px;
      background: #c60000;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s ease;
    }
    .btn:hover {
      background: #a30000;
    }
    .btn-success {
      background: #27ae60;
    }
    .btn-success:hover {
      background: #219653;
    }
    .btn-danger {
      background: #e74c3c;
    }
    .btn-danger:hover {
      background: #c0392b;
    }
    .file-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-left">
      <img id="logo" src="" alt="Logo">
    </div>
    <div class="header-title">
      <span>DASHBOARD - Districk KUPANG</span>
    </div>
    <div class="header-right">
      <!-- Ruang kosong untuk keseimbangan -->
    </div>
  </header>

  <div class="sidebar">
    <a href="#" onclick="showPage('master')"><i class="fas fa-cogs"></i> Master Komponen</a>
    <a href="#" onclick="showPage('stock')"><i class="fas fa-boxes"></i> Stock Komponen</a>
    <a href="#" onclick="showPage('reservasi')"><i class="fas fa-calendar-check"></i> Reservasi</a>
    <a href="#" onclick="showPage('service')"><i class="fas fa-headset"></i> Service Calls</a>
    <a href="#" onclick="showPage('settings')"><i class="fas fa-cog"></i> Pengaturan</a>
    <a href="#" onclick="showPage('logout')"><i class="fas fa-sign-out-alt"></i> Logout</a>
  </div>

  <div class="content">
    <!-- MASTER KOMPONEN -->
    <div id="master" class="card">
      <h2><i class="fas fa-cogs"></i> Master Komponen</h2>

      <!-- Import Excel -->
      <h3><i class="fas fa-file-excel"></i> Import File Excel</h3>
      <input type="file" id="importMaster" accept=".xlsx,.xls,.csv" onchange="importMasterExcel()" />

      <!-- Wrapper untuk tabel dan tools -->
      <div class="table-wrapper">
        <!-- Tools container yang sticky -->
        <div class="tools-container">
          <!-- Pencarian + Filter -->
          <div class="tools">
            <div>
              <label for="searchMaster"><i class="fas fa-search"></i> Cari:</label>
              <input type="text" id="searchMaster" placeholder="Part Number / Description" onkeyup="applyMasterFilter()" />
            </div>
            <div>
              <label for="filterPart"><i class="fas fa-filter"></i> Filter Part Number:</label>
              <select id="filterPart" onchange="applyMasterFilter()">
                <option value="all">Semua</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Tabel dengan container -->
        <div class="table-container">
          <table id="masterTable">
            <thead>
              <tr>
                <th>No.</th>
                <th>Part Number</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination">
        <div class="pagination-controls">
          <button id="prevMaster" onclick="prevMasterPage()"><i class="fas fa-arrow-left"></i> Back</button>
        </div>
        <div class="pagination-info">
          <span id="pageInfoMaster"></span>
        </div>
        <div class="rows-per-page">
          <label for="rowsPerPageMaster">Baris per halaman:</label>
          <select id="rowsPerPageMaster" onchange="changeRowsPerPageMaster()">
            <option value="10">10</option>
            <option value="15" selected>15</option>
            <option value="20">20</option>
            <option value="25">25</option>
            <option value="50">50</option>
          </select>
          <button id="nextMaster" onclick="nextMasterPage()">Next <i class="fas fa-arrow-right"></i></button>
        </div>
      </div>
    </div>

    <!-- STOCK SPAREPART -->
    <div id="stock" class="card" style="display:none;">
      <h2><i class="fas fa-boxes"></i> Data Stock Komponen</h2>

      <!-- Import Excel -->
      <h3><i class="fas fa-file-excel"></i> Import File Excel</h3>
      <input type="file" id="importFile" accept=".xlsx,.xls,.csv" onchange="importExcel()" />
      
      <!-- Download Excel -->
      <div class="file-actions">
        <button class="btn btn-success" onclick="exportStockToExcel()">
          <i class="fas fa-download"></i> Download Excel
        </button>
      </div>

      <!-- Wrapper untuk tabel dan tools -->
      <div class="table-wrapper">
        <!-- Tools container yang sticky -->
        <div class="tools-container">
          <div class="tools">
            <div>
              <label for="filterLokasi"><i class="fas fa-filter"></i> Filter Tipe Lokasi:</label>
              <select id="filterLokasi" onchange="applyFilter()">
                <option value="all">Semua</option>
              </select>
            </div>
            <div>
              <label for="searchInput"><i class="fas fa-search"></i> Cari:</label>
              <input type="text" id="searchInput" placeholder="Nama / Part / Deskripsi" onkeyup="applyFilter()" />
            </div>
          </div>
        </div>

        <!-- Tabel dengan container -->
        <div class="table-container">
          <table id="stockTable">
            <thead>
              <tr>
                <th>No.</th>
                <th>Tipe Lokasi</th>
                <th>Nama</th>
                <th>Part</th>
                <th>Deskripsi Part</th>
                <th>QTY</th>
                <th>QTY Alloc</th>
                <th>Available QTY</th>
                <th>Return To Factory</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="pagination">
        <div class="pagination-controls">
          <button id="prevBtn" onclick="prevPage()"><i class="fas fa-arrow-left"></i> Back</button>
        </div>
        <div class="pagination-info">
          <span id="pageInfo"></span>
        </div>
        <div class="rows-per-page">
          <label for="rowsPerPage">Baris per halaman:</label>
          <select id="rowsPerPage" onchange="changeRowsPerPage()">
            <option value="10">10</option>
            <option value="15" selected>15</option>
            <option value="20">20</option>
            <option value="25">25</option>
            <option value="50">50</option>
          </select>
          <button id="nextBtn" onclick="nextPage()">Next <i class="fas fa-arrow-right"></i></button>
        </div>
      </div>
    </div>

    <!-- RESERVASI -->
    <div id="reservasi" class="card" style="display:none;">
      <h2><i class="fas fa-calendar-check"></i> Reservasi Komponen</h2>

      <h3><i class="fas fa-file-excel"></i> Import File Excel</h3>
      <input type="file" id="importReservasi" accept=".xlsx,.xls,.csv" onchange="importReservasiExcel()" />
      
      <!-- Download Excel -->
      <div class="file-actions">
        <button class="btn btn-success" onclick="exportReservasiToExcel()">
          <i class="fas fa-download"></i> Download Excel
        </button>
      </div>
      
      <!-- Wrapper untuk tabel dan tools -->
      <div class="table-wrapper">
        <!-- Tools container yang sticky -->
        <div class="tools-container">
          <!-- Pencarian + Filter -->
          <div class="tools">
            <div>
              <label for="searchReservasi"><i class="fas fa-search"></i> Cari:</label>
              <input type="text" id="searchReservasi" placeholder="Nomor / Catatan / Part" onkeyup="applyReservasiFilter()" />
            </div>
            <div>
              <label for="filterTeknisi"><i class="fas fa-filter"></i> Filter Berdasarkan Teknisi Perbaikan:</label>
              <select id="filterTeknisi" onchange="applyReservasiFilter()">
                <option value="all">Semua</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Tabel dengan container -->
        <div class="table-container">
          <table id="reservasiTable">
            <thead>
              <tr>
                <th>Nomor</th>
                <th>Catatan</th>
                <th>Part</th>
                <th>Qty Reservasi</th>
                <th>Qty Transaksi</th>
                <th>Qty Close</th>
                <th>Part Demand</th>
                <th>Serial Number</th>
                <th>Return To Factory</th>
                <th>Teknisi Perbaikan</th>
                <th>Analisa SA</th>
                <th>Disetujui Pada</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="pagination">
        <div class="pagination-controls">
          <button id="prevReservasi" onclick="prevReservasiPage()"><i class="fas fa-arrow-left"></i> Back</button>
        </div>
        <div class="pagination-info">
          <span id="pageInfoReservasi"></span>
        </div>
        <div class="rows-per-page">
          <label for="rowsPerPageReservasi">Baris per halaman:</label>
          <select id="rowsPerPageReservasi" onchange="changeRowsPerPageReservasi()">
            <option value="10">10</option>
            <option value="15" selected>15</option>
            <option value="20">20</option>
            <option value="25">25</option>
            <option value="50">50</option>
          </select>
          <button id="nextReservasi" onclick="nextReservasiPage()">Next <i class="fas fa-arrow-right"></i></button>
        </div>
      </div>
    </div>

    <!-- SERVICE CALLS -->
    <div id="service" class="card" style="display:none;">
      <h2><i class="fas fa-headset"></i> Service Calls</h2>

      <h3><i class="fas fa-file-excel"></i> Import File Excel</h3>
      <input type="file" id="importService" accept=".xlsx,.xls,.csv" onchange="importServiceExcel()" />
      
      <!-- Download Excel -->
      <div class="file-actions">
        <button class="btn btn-success" onclick="exportServiceToExcel()">
          <i class="fas fa-download"></i> Download Excel
        </button>
      </div>
      
      <!-- Wrapper untuk tabel dan tools -->
      <div class="table-wrapper">
        <!-- Tools container yang sticky -->
        <div class="tools-container">
          <!-- Pencarian + Filter -->
          <div class="tools">
            <div>
              <label for="searchService"><i class="fas fa-search"></i> Cari:</label>
              <input type="text" id="searchService" placeholder="Nomor Service Call / Nama Pemilik" onkeyup="applyServiceFilter()" />
            </div>
            <div>
              <label for="filterJenisLayanan"><i class="fas fa-filter"></i> Filter Jenis Layanan:</label>
              <select id="filterJenisLayanan" onchange="applyServiceFilter()">
                <option value="all">Semua</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Tabel dengan container -->
        <div class="table-container">
          <table id="serviceTable">
            <thead>
              <tr>
                <th>Tanggal Pendaftaran</th>
                <th>Nomor Service Call</th>
                <th>Jenis Layanan</th>
                <th>Jenis Garansi</th>
                <th>Tipe Demand</th>
                <th>Nomor Seri</th>
                <th>Nama Pemilik</th>
                <th>Alamat Pemilik</th>
                <th>Nama Teknisi</th>
                <th>Tanggal Serah Terima</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="pagination">
        <div class="pagination-controls">
          <button id="prevService" onclick="prevServicePage()"><i class="fas fa-arrow-left"></i> Back</button>
        </div>
        <div class="pagination-info">
          <span id="pageInfoService"></span>
        </div>
        <div class="rows-per-page">
          <label for="rowsPerPageService">Baris per halaman:</label>
          <select id="rowsPerPageService" onchange="changeRowsPerPageService()">
            <option value="10">10</option>
            <option value="15" selected>15</option>
            <option value="20">20</option>
            <option value="25">25</option>
            <option value="50">50</option>
          </select>
          <button id="nextService" onclick="nextServicePage()">Next <i class="fas fa-arrow-right"></i></button>
        </div>
      </div>
    </div>

    <!-- PENGATURAN -->
    <div id="settings" class="card" style="display:none;">
      <h2><i class="fas fa-cog"></i> Pengaturan</h2>
      
      <div class="settings-section">
        <h3><i class="fas fa-image"></i> Upload Logo</h3>
        <input type="file" id="logoInput" accept="image/*" onchange="changeLogo()" />
        <p>Logo yang diupload akan tampil di bagian header dashboard.</p>
      </div>
      
      <div class="settings-section">
        <h3><i class="fas fa-database"></i> Pengaturan Database</h3>
        <p>Pengaturan koneksi dan manajemen database.</p>
      </div>
      
      <div class="settings-section">
        <h3><i class="fas fa-user-cog"></i> Pengaturan Pengguna</h3>
        <p>Kelola pengguna, hak akses, dan izin.</p>
      </div>
      
      <div class="settings-section">
        <h3><i class="fas fa-bell"></i> Notifikasi</h3>
        <p>Konfigurasi notifikasi dan pengingat sistem.</p>
      </div>
      
      <div class="settings-section">
        <h3><i class="fas fa-save"></i> Penyimpanan Data</h3>
        <p>Data akan otomatis tersimpan di browser (localStorage) setiap kali ada perubahan.</p>
        <button class="btn btn-danger" onclick="clearAllData()">Hapus Semua Data Tersimpan</button>
      </div>
    </div>

    <!-- LOGOUT -->
    <div id="logout" class="card" style="display:none;">
      <h2><i class="fas fa-sign-out-alt"></i> Logout</h2>
      <p>Anda telah keluar dari sistem.</p>
    </div>
  </div>

  <!-- Notification -->
  <div id="notification" class="notification"></div>

  <script>
    // ---- GLOBAL FUNCTION ----
    function showPage(pageId) {
      const pages = document.querySelectorAll('.card');
      pages.forEach(p => p.style.display = "none");
      document.getElementById(pageId).style.display = "block";
    }

    // ---- NOTIFICATION ----
    function showNotification(message, duration = 3000) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.style.display = 'block';
      
      setTimeout(() => {
        notification.style.display = 'none';
      }, duration);
    }

    // ---- LOCAL STORAGE MANAGEMENT ----
    function saveToLocalStorage(key, data) {
      try {
        localStorage.setItem(key, JSON.stringify(data));
        showNotification('Data berhasil disimpan!');
      } catch (e) {
        console.error('Gagal menyimpan data ke localStorage:', e);
        showNotification('Gagal menyimpan data!', 5000);
      }
    }

    function loadFromLocalStorage(key, defaultValue = []) {
      try {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : defaultValue;
      } catch (e) {
        console.error('Gagal memuat data dari localStorage:', e);
        return defaultValue;
      }
    }

    function clearAllData() {
      if (confirm('Apakah Anda yakin ingin menghapus semua data tersimpan?')) {
        localStorage.removeItem('masterData');
        localStorage.removeItem('stockData');
        localStorage.removeItem('reservasiData');
        localStorage.removeItem('serviceData');
        showNotification('Semua data berhasil dihapus!');
        
        // Reset data di memori
        masterData = [];
        filteredMaster = [];
        allData = [];
        filteredStock = [];
        reservasiData = [];
        filteredReservasi = [];
        serviceData = [];
        filteredService = [];
        
        // Render ulang tabel
        if (document.getElementById('master').style.display !== 'none') {
          renderMasterTable();
        } else if (document.getElementById('stock').style.display !== 'none') {
          renderTable();
        } else if (document.getElementById('reservasi').style.display !== 'none') {
          renderReservasiTable();
        } else if (document.getElementById('service').style.display !== 'none') {
          renderServiceTable();
        }
      }
    }

    // ---- EXPORT TO EXCEL ----
    function exportStockToExcel() {
      if (filteredStock.length === 0) {
        showNotification('Tidak ada data untuk diekspor!', 5000);
        return;
      }

      // Buat workbook baru
      const wb = XLSX.utils.book_new();
      
      // Buat worksheet dari data
      const ws = XLSX.utils.json_to_sheet(filteredStock.map((row, index) => {
        return {
          "No.": index + 1,
          "Tipe Lokasi": row[stockIndexMap[1]] || "",
          "Nama": row[stockIndexMap[2]] || "",
          "Part": row[stockIndexMap[3]] || "",
          "Deskripsi Part": row[stockIndexMap[4]] || "",
          "QTY": row[stockIndexMap[5]] || "",
          "QTY Alloc": row[stockIndexMap[6]] || "",
          "Available QTY": row[stockIndexMap[7]] || "",
          "Return To Factory": row[stockIndexMap[8]] || ""
        };
      }));
      
      // Tambahkan worksheet ke workbook
      XLSX.utils.book_append_sheet(wb, ws, "Stock Komponen");
      
      // Generate nama file dengan timestamp
      const now = new Date();
      const timestamp = now.getFullYear() + 
                      String(now.getMonth() + 1).padStart(2, '0') + 
                      String(now.getDate()).padStart(2, '0') + '_' +
                      String(now.getHours()).padStart(2, '0') + 
                      String(now.getMinutes()).padStart(2, '0');
      const fileName = `Data_Stock_Komponen_${timestamp}.xlsx`;
      
      // Download file
      XLSX.writeFile(wb, fileName);
      
      showNotification('Data berhasil diekspor ke Excel!');
    }

    // ---- EXPORT RESERVASI TO EXCEL ----
    function exportReservasiToExcel() {
      if (filteredReservasi.length === 0) {
        showNotification('Tidak ada data untuk diekspor!', 5000);
        return;
      }

      // Buat workbook baru
      const wb = XLSX.utils.book_new();
      
      // Buat worksheet dari data
      const ws = XLSX.utils.json_to_sheet(filteredReservasi.map((row, index) => {
        return {
          "No.": index + 1,
          "Nomor": row[reservasiIndexMap[0]] || "",
          "Catatan": row[reservasiIndexMap[1]] || "",
          "Part": row[reservasiIndexMap[2]] || "",
          "Qty Reservasi": row[reservasiIndexMap[3]] || "",
          "Qty Transaksi": row[reservasiIndexMap[4]] || "",
          "Qty Close": row[reservasiIndexMap[5]] || "",
          "Part Demand": row[reservasiIndexMap[6]] || "",
          "Serial Number": row[reservasiIndexMap[7]] || "",
          "Return To Factory": row[reservasiIndexMap[8]] || "",
          "Teknisi Perbaikan": row[reservasiIndexMap[9]] || "",
          "Analisa SA": row[reservasiIndexMap[10]] || "",
          "Disetujui Pada": formatDateTime(row[reservasiIndexMap[11]])
        };
      }));
      
      // Tambahkan worksheet ke workbook
      XLSX.utils.book_append_sheet(wb, ws, "Reservasi Komponen");
      
      // Generate nama file dengan timestamp
      const now = new Date();
      const timestamp = now.getFullYear() + 
                      String(now.getMonth() + 1).padStart(2, '0') + 
                      String(now.getDate()).padStart(2, '0') + '_' +
                      String(now.getHours()).padStart(2, '0') + 
                      String(now.getMinutes()).padStart(2, '0');
      const fileName = `Data_Reservasi_Komponen_${timestamp}.xlsx`;
      
      // Download file
      XLSX.writeFile(wb, fileName);
      
      showNotification('Data reservasi berhasil diekspor ke Excel!');
    }

    // ---- EXPORT SERVICE TO EXCEL ----
    function exportServiceToExcel() {
      if (filteredService.length === 0) {
        showNotification('Tidak ada data untuk diekspor!', 5000);
        return;
      }

      // Buat workbook baru
      const wb = XLSX.utils.book_new();
      
      // Buat worksheet dari data
      const ws = XLSX.utils.json_to_sheet(filteredService.map((row, index) => {
        return {
          "No.": index + 1,
          "Tanggal Pendaftaran": formatDateOnly(row[serviceIndexMap[0]]),
          "Nomor Service Call": row[serviceIndexMap[1]] || "",
          "Jenis Layanan": row[serviceIndexMap[2]] || "",
          "Jenis Garansi": row[serviceIndexMap[3]] || "",
          "Tipe Demand": row[serviceIndexMap[4]] || "",
          "Nomor Seri": row[serviceIndexMap[5]] || "",
          "Nama Pemilik": row[serviceIndexMap[6]] || "",
          "Alamat Pemilik": row[serviceIndexMap[7]] || "",
          "Nama Teknisi": row[serviceIndexMap[8]] || "",
          "Tanggal Serah Terima": formatDateTime(row[serviceIndexMap[9]])
        };
      }));
      
      // Tambahkan worksheet ke workbook
      XLSX.utils.book_append_sheet(wb, ws, "Service Calls");
      
      // Generate nama file dengan timestamp
      const now = new Date();
      const timestamp = now.getFullYear() + 
                      String(now.getMonth() + 1).padStart(2, '0') + 
                      String(now.getDate()).padStart(2, '0') + '_' +
                      String(now.getHours()).padStart(2, '0') + 
                      String(now.getMinutes()).padStart(2, '0');
      const fileName = `Data_Service_Calls_${timestamp}.xlsx`;
      
      // Download file
      XLSX.writeFile(wb, fileName);
      
      showNotification('Data service calls berhasil diekspor ke Excel!');
    }

    // ---- LOGO ----
    function changeLogo() {
      const file = document.getElementById("logoInput").files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById("logo").src = e.target.result;
          localStorage.setItem("dashboardLogo", e.target.result); // simpan di local storage
        };
        reader.readAsDataURL(file);
      }
    }

    // ---- FUNGSI FORMAT TANGGAL ----
    function formatDateTime(dateString) {
      if (!dateString) return "";
      
      // Jika dateString adalah objek Date Excel (angka)
      if (typeof dateString === 'number') {
        const date = new Date((dateString - 25569) * 86400 * 1000);
        return formatDateObject(date);
      }
      
      // Coba parsing sebagai string tanggal
      const date = new Date(dateString);
      if (isNaN(date.getTime())) {
        return dateString; // Kembalikan asli jika tidak bisa diparsing
      }
      
      return formatDateObject(date);
    }
    
    function formatDateObject(date) {
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = date.getFullYear();
      const hours = String(date.getHours()).padStart(2, '0');
      const minutes = String(date.getMinutes()).padStart(2, '0');
      
      return `${day}/${month}/${year} ${hours}:${minutes}`;
    }
    
    // ---- FUNGSI FORMAT TANGGAL SAJA (TANPA JAM) ----
    function formatDateOnly(dateString) {
      if (!dateString) return "";
      
      // Jika dateString adalah objek Date Excel (angka)
      if (typeof dateString === 'number') {
        const date = new Date((dateString - 25569) * 86400 * 1000);
        return formatDateOnlyObject(date);
      }
      
      // Coba parsing sebagai string tanggal
      const date = new Date(dateString);
      if (isNaN(date.getTime())) {
        return dateString; // Kembalikan asli jika tidak bisa diparsing
      }
      
      return formatDateOnlyObject(date);
    }
    
    function formatDateOnlyObject(date) {
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = date.getFullYear();
      
      return `${day}/${month}/${year}`;
    }

    // ---- MASTER KOMPONEN ----
    let masterData = [];
    let filteredMaster = [];
    let currentMasterPage = 1;
    let rowsPerPageMaster = 15; // Diubah dari 20 menjadi 15

    function importMasterExcel() {
      const file = document.getElementById('importMaster').files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type: 'array'});
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const json = XLSX.utils.sheet_to_json(sheet, {header:1});

        const headers = ["No.","Part Number","Description"];
        const excelHeaders = json[0].map(h => h.toString().trim());
        let indexMap = headers.map(h => excelHeaders.indexOf(h));

        masterData = json.slice(1).filter(r => r.length > 0).map(r => [
          r[indexMap[1]] || "",
          r[indexMap[2]] || ""
        ]);

        // Simpan ke localStorage
        saveToLocalStorage('masterData', masterData);
        
        updatePartFilter(masterData);
        filteredMaster = masterData;
        currentMasterPage = 1;
        renderMasterTable();
      };
      reader.readAsArrayBuffer(file);
    }

    function updatePartFilter(data) {
      const select = document.getElementById("filterPart");
      select.innerHTML = '<option value="all">Semua</option>';
      const initials = new Set();
      data.forEach(row => {
        if (row[0]) initials.add(row[0].toString().charAt(0).toUpperCase());
      });
      [...initials].sort().forEach(l => {
        let opt = document.createElement("option");
        opt.value = l;
        opt.textContent = l;
        select.appendChild(opt);
      });
    }

    function renderMasterTable() {
      const tbody = document.getElementById("masterTable").querySelector("tbody");
      tbody.innerHTML = "";

      const start = (currentMasterPage - 1) * rowsPerPageMaster;
      const end = start + rowsPerPageMaster;
      const pageData = filteredMaster.slice(start, end);

      pageData.forEach((row, i) => {
        let newRow = tbody.insertRow();
        
        // Kolom No. (rata kiri)
        let cellNo = newRow.insertCell();
        cellNo.textContent = start + i + 1;
        cellNo.className = "text-left";
        
        // Kolom Part Number (rata kiri)
        let cellPart = newRow.insertCell();
        cellPart.textContent = row[0];
        cellPart.className = "text-left";
        
        // Kolom Description (rata kiri)
        let cellDesc = newRow.insertCell();
        cellDesc.textContent = row[1];
        cellDesc.className = "text-left";
      });

      document.getElementById("pageInfoMaster").textContent =
        `Halaman ${currentMasterPage} dari ${Math.ceil(filteredMaster.length / rowsPerPageMaster)}`;

      document.getElementById("prevMaster").disabled = currentMasterPage === 1;
      document.getElementById("nextMaster").disabled = end >= filteredMaster.length;
    }

    function applyMasterFilter() {
      const searchVal = document.getElementById("searchMaster").value.toLowerCase();
      const filterVal = document.getElementById("filterPart").value;

      filteredMaster = masterData;

      if (filterVal !== "all") {
        filteredMaster = filteredMaster.filter(r => r[0].toString().toUpperCase().startsWith(filterVal));
      }

      if (searchVal) {
        filteredMaster = filteredMaster.filter(r => {
          return (
            (r[0] && r[0].toString().toLowerCase().includes(searchVal)) ||
            (r[1] && r[1].toString().toLowerCase().includes(searchVal))
          );
        });
      }

      currentMasterPage = 1;
      renderMasterTable();
    }

    function prevMasterPage() {
      if (currentMasterPage > 1) {
        currentMasterPage--;
        renderMasterTable();
      }
    }

    function nextMasterPage() {
      if (currentMasterPage * rowsPerPageMaster < filteredMaster.length) {
        currentMasterPage++;
        renderMasterTable();
      }
    }

    function changeRowsPerPageMaster() {
      rowsPerPageMaster = parseInt(document.getElementById("rowsPerPageMaster").value);
      currentMasterPage = 1;
      renderMasterTable();
    }

    // ---- STOCK KOMPONEN ----
    let stockIndexMap = [];
    let filteredStock = [];
    let currentStockPage = 1;
    let rowsPerPageStock = 15; // Diubah dari 20 menjadi 15

    function importExcel() {
      const file = document.getElementById('importFile').files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type: 'array'});
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const json = XLSX.utils.sheet_to_json(sheet, {header:1});

        const headers = ["No.","Tipe Lokasi","Nama","Part","Deskripsi Part","QTY","QTY Alloc","Available QTY","Return To Factory"];
        const excelHeaders = json[0].map(h => h.toString().trim());
        stockIndexMap = headers.map(h => excelHeaders.indexOf(h));

        allData = json.slice(1).filter(r => r.length > 0);
        
        // Simpan ke localStorage
        saveToLocalStorage('stockData', allData);
        
        filteredStock = allData;

        updateFilterOptions(allData);
        currentStockPage = 1;
        renderTable();
      };
      reader.readAsArrayBuffer(file);
    }

    function renderTable() {
      const tbody = document.getElementById("stockTable").querySelector("tbody");
      tbody.innerHTML = "";

      const start = (currentStockPage - 1) * rowsPerPageStock;
      const end = start + rowsPerPageStock;
      const pageData = filteredStock.slice(start, end);

      pageData.forEach((row, i) => {
        let newRow = tbody.insertRow();
        
        // Kolom No. (rata kiri)
        let cellNo = newRow.insertCell();
        cellNo.textContent = start + i + 1;
        cellNo.className = "text-left";
        
        // Kolom Tipe Lokasi (rata kiri)
        let cellTipe = newRow.insertCell();
        cellTipe.textContent = row[stockIndexMap[1]] || "";
        cellTipe.className = "text-left";
        
        // Kolom Nama (rata kiri)
        let cellNama = newRow.insertCell();
        cellNama.textContent = row[stockIndexMap[2]] || "";
        cellNama.className = "text-left";
        
        // Kolom Part (rata kiri)
        let cellPart = newRow.insertCell();
        cellPart.textContent = row[stockIndexMap[3]] || "";
        cellPart.className = "text-left";
        
        // Kolom Deskripsi Part (rata kiri)
        let cellDesc = newRow.insertCell();
        cellDesc.textContent = row[stockIndexMap[4]] || "";
        cellDesc.className = "text-left";
        
        // Kolom QTY (rata kiri)
        let cellQty = newRow.insertCell();
        cellQty.textContent = row[stockIndexMap[5]] || "";
        cellQty.className = "text-left";
        
        // Kolom QTY Alloc (rata kiri)
        let cellAlloc = newRow.insertCell();
        cellAlloc.textContent = row[stockIndexMap[6]] || "";
        cellAlloc.className = "text-left";
        
        // Kolom Available QTY (rata kiri)
        let cellAvailable = newRow.insertCell();
        cellAvailable.textContent = row[stockIndexMap[7]] || "";
        cellAvailable.className = "text-left";
        
        // Kolom Return To Factory (rata kiri)
        let cellReturn = newRow.insertCell();
        cellReturn.textContent = row[stockIndexMap[8]] || "";
        cellReturn.className = "text-left";
      });

      document.getElementById("pageInfo").textContent =
        `Halaman ${currentStockPage} dari ${Math.ceil(filteredStock.length / rowsPerPageStock)}`;

      document.getElementById("prevBtn").disabled = currentStockPage === 1;
      document.getElementById("nextBtn").disabled = end >= filteredStock.length;
    }

    function updateFilterOptions(data) {
      const lokasiSet = new Set();
      data.forEach(row => {
        const val = row[stockIndexMap[1]];
        if (val) lokasiSet.add(val);
      });

      const select = document.getElementById("filterLokasi");
      select.innerHTML = '<option value="all">Semua</option>';
      lokasiSet.forEach(l => {
        let opt = document.createElement("option");
        opt.value = l;
        opt.textContent = l;
        select.appendChild(opt);
      });
    }

    function applyFilter() {
      const filterVal = document.getElementById("filterLokasi").value;
      const searchVal = document.getElementById("searchInput").value.toLowerCase();

      filteredStock = allData;

      if (filterVal !== "all") {
        filteredStock = filteredStock.filter(r => r[stockIndexMap[1]] == filterVal);
      }

      if (searchVal) {
        filteredStock = filteredStock.filter(r => {
          return (
            (r[stockIndexMap[2]] && r[stockIndexMap[2]].toString().toLowerCase().includes(searchVal)) ||
            (r[stockIndexMap[3]] && r[stockIndexMap[3]].toString().toLowerCase().includes(searchVal)) ||
            (r[stockIndexMap[4]] && r[stockIndexMap[4]].toString().toLowerCase().includes(searchVal))
          );
        });
      }

      currentStockPage = 1;
      renderTable();
    }

    function prevPage() {
      if (currentStockPage > 1) {
        currentStockPage--;
        renderTable();
      }
    }

    function nextPage() {
      if (currentStockPage * rowsPerPageStock < filteredStock.length) {
        currentStockPage++;
        renderTable();
      }
    }

    function changeRowsPerPage() {
      rowsPerPageStock = parseInt(document.getElementById("rowsPerPage").value);
      currentStockPage = 1;
      renderTable();
    }

    // ---- RESERVASI ----
    let reservasiData = [];
    let reservasiIndexMap = [];
    let filteredReservasi = [];
    let currentReservasiPage = 1;
    let rowsPerPageReservasi = 15;

    function importReservasiExcel() {
      const file = document.getElementById('importReservasi').files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type: 'array'});
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const json = XLSX.utils.sheet_to_json(sheet, {header:1});

        const headers = ["Nomor","Catatan","Part","Qty Reservasi","Qty Transaksi","Qty Close","Part Demand","Serial Number","Return To Factory","Teknisi Perbaikan","Analisa SA","Disetujui Pada"];
        const excelHeaders = json[0].map(h => h.toString().trim());
        reservasiIndexMap = headers.map(h => excelHeaders.indexOf(h));

        reservasiData = json.slice(1).filter(r => r.length > 0);
        
        // Simpan ke localStorage
        saveToLocalStorage('reservasiData', reservasiData);
        
        filteredReservasi = reservasiData;
        currentReservasiPage = 1;
        
        updateTeknisiFilter(reservasiData);
        renderReservasiTable();
      };
      reader.readAsArrayBuffer(file);
    }

    function updateTeknisiFilter(data) {
      const teknisiSet = new Set();
      data.forEach(row => {
        const val = row[reservasiIndexMap[9]]; // Teknisi Perbaikan
        if (val) teknisiSet.add(val);
      });

      const select = document.getElementById("filterTeknisi");
      select.innerHTML = '<option value="all">Semua</option>';
      [...teknisiSet].sort().forEach(t => {
        let opt = document.createElement("option");
        opt.value = t;
        opt.textContent = t;
        select.appendChild(opt);
      });
    }

    function renderReservasiTable() {
      const tbody = document.getElementById("reservasiTable").querySelector("tbody");
      tbody.innerHTML = "";

      const start = (currentReservasiPage - 1) * rowsPerPageReservasi;
      const end = start + rowsPerPageReservasi;
      const pageData = filteredReservasi.slice(start, end);

      pageData.forEach((row, i) => {
        let newRow = tbody.insertRow();
        
        // Kolom Nomor (rata kiri)
        let cellNomor = newRow.insertCell();
        cellNomor.textContent = row[reservasiIndexMap[0]] || "";
        cellNomor.className = "text-left";
        
        // Kolom Catatan (rata kiri)
        let cellCatatan = newRow.insertCell();
        cellCatatan.textContent = row[reservasiIndexMap[1]] || "";
        cellCatatan.className = "text-left";
        
        // Kolom Part (rata kiri)
        let cellPart = newRow.insertCell();
        cellPart.textContent = row[reservasiIndexMap[2]] || "";
        cellPart.className = "text-left";
        
        // Kolom Qty Reservasi (rata kiri)
        let cellQtyReservasi = newRow.insertCell();
        cellQtyReservasi.textContent = row[reservasiIndexMap[3]] || "";
        cellQtyReservasi.className = "text-left";
        
        // Kolom Qty Transaksi (rata kiri)
        let cellQtyTransaksi = newRow.insertCell();
        cellQtyTransaksi.textContent = row[reservasiIndexMap[4]] || "";
        cellQtyTransaksi.className = "text-left";
        
        // Kolom Qty Close (rata kiri)
        let cellQtyClose = newRow.insertCell();
        cellQtyClose.textContent = row[reservasiIndexMap[5]] || "";
        cellQtyClose.className = "text-left";
        
        // Kolom Part Demand (rata kiri)
        let cellPartDemand = newRow.insertCell();
        cellPartDemand.textContent = row[reservasiIndexMap[6]] || "";
        cellPartDemand.className = "text-left";
        
        // Kolom Serial Number (rata kiri)
        let cellSerial = newRow.insertCell();
        cellSerial.textContent = row[reservasiIndexMap[7]] || "";
        cellSerial.className = "text-left";
        
        // Kolom Return To Factory (rata kiri)
        let cellReturn = newRow.insertCell();
        cellReturn.textContent = row[reservasiIndexMap[8]] || "";
        cellReturn.className = "text-left";
        
        // Kolom Teknisi Perbaikan (rata kiri)
        let cellTeknisi = newRow.insertCell();
        cellTeknisi.textContent = row[reservasiIndexMap[9]] || "";
        cellTeknisi.className = "text-left";
        
        // Kolom Analisa SA (rata kiri)
        let cellAnalisa = newRow.insertCell();
        cellAnalisa.textContent = row[reservasiIndexMap[10]] || "";
        cellAnalisa.className = "text-left";
        
        // Kolom Disetujui Pada (rata kiri) dengan format tanggal
        let cellDisetujui = newRow.insertCell();
        const tanggalValue = row[reservasiIndexMap[11]] || "";
        cellDisetujui.textContent = formatDateTime(tanggalValue);
        cellDisetujui.className = "text-left";
      });

      document.getElementById("pageInfoReservasi").textContent =
        `Halaman ${currentReservasiPage} dari ${Math.ceil(filteredReservasi.length / rowsPerPageReservasi)}`;

      document.getElementById("prevReservasi").disabled = currentReservasiPage === 1;
      document.getElementById("nextReservasi").disabled = end >= filteredReservasi.length;
    }

    function applyReservasiFilter() {
      const searchVal = document.getElementById("searchReservasi").value.toLowerCase();
      const filterTeknisi = document.getElementById("filterTeknisi").value;

      filteredReservasi = reservasiData;

      // Filter berdasarkan Teknisi Perbaikan
      if (filterTeknisi !== "all") {
        filteredReservasi = filteredReservasi.filter(r => {
          const teknisi = r[reservasiIndexMap[9]] || "";
          return teknisi === filterTeknisi;
        });
      }

      // Filter berdasarkan pencarian
      if (searchVal) {
        filteredReservasi = filteredReservasi.filter(r => {
          return (
            (r[reservasiIndexMap[0]] && r[reservasiIndexMap[0]].toString().toLowerCase().includes(searchVal)) ||
            (r[reservasiIndexMap[1]] && r[reservasiIndexMap[1]].toString().toLowerCase().includes(searchVal)) ||
            (r[reservasiIndexMap[2]] && r[reservasiIndexMap[2]].toString().toLowerCase().includes(searchVal))
          );
        });
      }

      currentReservasiPage = 1;
      renderReservasiTable();
    }

    function prevReservasiPage() {
      if (currentReservasiPage > 1) {
        currentReservasiPage--;
        renderReservasiTable();
      }
    }

    function nextReservasiPage() {
      if (currentReservasiPage * rowsPerPageReservasi < filteredReservasi.length) {
        currentReservasiPage++;
        renderReservasiTable();
      }
    }

    function changeRowsPerPageReservasi() {
      rowsPerPageReservasi = parseInt(document.getElementById("rowsPerPageReservasi").value);
      currentReservasiPage = 1;
      renderReservasiTable();
    }

    // ---- SERVICE CALLS ----
    let serviceData = [];
    let serviceIndexMap = [];
    let filteredService = [];
    let currentServicePage = 1;
    let rowsPerPageService = 15;

    function importServiceExcel() {
      const file = document.getElementById('importService').files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type: 'array'});
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const json = XLSX.utils.sheet_to_json(sheet, {header:1});

        const headers = ["Tanggal Pendaftaran","Nomor Service Call","Jenis Layanan","Jenis Garansi","Tipe Demand","Nomor Seri","Nama Pemilik","Alamat Pemilik","Nama Teknisi","Tanggal Serah Terima"];
        const excelHeaders = json[0].map(h => h.toString().trim());
        serviceIndexMap = headers.map(h => excelHeaders.indexOf(h));

        serviceData = json.slice(1).filter(r => r.length > 0);
        
        // Simpan ke localStorage
        saveToLocalStorage('serviceData', serviceData);
        
        filteredService = serviceData;
        currentServicePage = 1;
        
        updateJenisLayananFilter(serviceData);
        renderServiceTable();
      };
      reader.readAsArrayBuffer(file);
    }

    function updateJenisLayananFilter(data) {
      const jenisLayananSet = new Set();
      data.forEach(row => {
        const val = row[serviceIndexMap[2]]; // Jenis Layanan
        if (val) jenisLayananSet.add(val);
      });

      const select = document.getElementById("filterJenisLayanan");
      select.innerHTML = '<option value="all">Semua</option>';
      [...jenisLayananSet].sort().forEach(j => {
        let opt = document.createElement("option");
        opt.value = j;
        opt.textContent = j;
        select.appendChild(opt);
      });
    }

    function renderServiceTable() {
      const tbody = document.getElementById("serviceTable").querySelector("tbody");
      tbody.innerHTML = "";

      const start = (currentServicePage - 1) * rowsPerPageService;
      const end = start + rowsPerPageService;
      const pageData = filteredService.slice(start, end);

      pageData.forEach((row, i) => {
        let newRow = tbody.insertRow();
        
        // Kolom Tanggal Pendaftaran (rata kiri) dengan format tanggal saja
        let cellTanggalDaftar = newRow.insertCell();
        const tanggalDaftarValue = row[serviceIndexMap[0]] || "";
        cellTanggalDaftar.textContent = formatDateOnly(tanggalDaftarValue);
        cellTanggalDaftar.className = "text-left";
        
        // Kolom Nomor Service Call (rata kiri)
        let cellNomorService = newRow.insertCell();
        cellNomorService.textContent = row[serviceIndexMap[1]] || "";
        cellNomorService.className = "text-left";
        
        // Kolom Jenis Layanan (rata kiri)
        let cellJenisLayanan = newRow.insertCell();
        cellJenisLayanan.textContent = row[serviceIndexMap[2]] || "";
        cellJenisLayanan.className = "text-left";
        
        // Kolom Jenis Garansi (rata kiri)
        let cellJenisGaransi = newRow.insertCell();
        cellJenisGaransi.textContent = row[serviceIndexMap[3]] || "";
        cellJenisGaransi.className = "text-left";
        
        // Kolom Tipe Demand (rata kiri)
        let cellTipeDemand = newRow.insertCell();
        cellTipeDemand.textContent = row[serviceIndexMap[4]] || "";
        cellTipeDemand.className = "text-left";
        
        // Kolom Nomor Seri (rata kiri)
        let cellNomorSeri = newRow.insertCell();
        cellNomorSeri.textContent = row[serviceIndexMap[5]] || "";
        cellNomorSeri.className = "text-left";
        
        // Kolom Nama Pemilik (rata kiri)
        let cellNamaPemilik = newRow.insertCell();
        cellNamaPemilik.textContent = row[serviceIndexMap[6]] || "";
        cellNamaPemilik.className = "text-left";
        
        // Kolom Alamat Pemilik (rata kiri)
        let cellAlamatPemilik = newRow.insertCell();
        cellAlamatPemilik.textContent = row[serviceIndexMap[7]] || "";
        cellAlamatPemilik.className = "text-left";
        
        // Kolom Nama Teknisi (rata kiri)
        let cellNamaTeknisi = newRow.insertCell();
        cellNamaTeknisi.textContent = row[serviceIndexMap[8]] || "";
        cellNamaTeknisi.className = "text-left";
        
        // Kolom Tanggal Serah Terima (rata kiri) dengan format tanggal
        let cellTanggalSerah = newRow.insertCell();
        const tanggalSerahValue = row[serviceIndexMap[9]] || "";
        cellTanggalSerah.textContent = formatDateTime(tanggalSerahValue);
        cellTanggalSerah.className = "text-left";
      });

      document.getElementById("pageInfoService").textContent =
        `Halaman ${currentServicePage} dari ${Math.ceil(filteredService.length / rowsPerPageService)}`;

      document.getElementById("prevService").disabled = currentServicePage === 1;
      document.getElementById("nextService").disabled = end >= filteredService.length;
    }

    function applyServiceFilter() {
      const searchVal = document.getElementById("searchService").value.toLowerCase();
      const filterJenisLayanan = document.getElementById("filterJenisLayanan").value;

      filteredService = serviceData;

      // Filter berdasarkan Jenis Layanan
      if (filterJenisLayanan !== "all") {
        filteredService = filteredService.filter(r => {
          const jenisLayanan = r[serviceIndexMap[2]] || "";
          return jenisLayanan === filterJenisLayanan;
        });
      }

      // Filter berdasarkan pencarian
      if (searchVal) {
        filteredService = filteredService.filter(r => {
          return (
            (r[serviceIndexMap[1]] && r[serviceIndexMap[1]].toString().toLowerCase().includes(searchVal)) ||
            (r[serviceIndexMap[6]] && r[serviceIndexMap[6]].toString().toLowerCase().includes(searchVal))
          );
        });
      }

      currentServicePage = 1;
      renderServiceTable();
    }

    function prevServicePage() {
      if (currentServicePage > 1) {
        currentServicePage--;
        renderServiceTable();
      }
    }

    function nextServicePage() {
      if (currentServicePage * rowsPerPageService < filteredService.length) {
        currentServicePage++;
        renderServiceTable();
      }
    }

    function changeRowsPerPageService() {
      rowsPerPageService = parseInt(document.getElementById("rowsPerPageService").value);
      currentServicePage = 1;
      renderServiceTable();
    }

    // load data dari localStorage saat halaman dimuat
    window.onload = function() {
      // Load logo
      const savedLogo = localStorage.getItem("dashboardLogo");
      if (savedLogo) document.getElementById("logo").src = savedLogo;
      
      // Load data dari localStorage
      masterData = loadFromLocalStorage('masterData');
      filteredMaster = masterData;
      updatePartFilter(masterData);
      renderMasterTable();
      
      allData = loadFromLocalStorage('stockData');
      filteredStock = allData;
      updateFilterOptions(allData);
      renderTable();
      
      reservasiData = loadFromLocalStorage('reservasiData');
      filteredReservasi = reservasiData;
      updateTeknisiFilter(reservasiData);
      renderReservasiTable();
      
      serviceData = loadFromLocalStorage('serviceData');
      filteredService = serviceData;
      updateJenisLayananFilter(serviceData);
      renderServiceTable();
    };
  </script>
</body>
</html>
